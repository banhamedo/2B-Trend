<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>لوحة تحكم العميل - 2B Trend</title>
    <!-- Bootstrap RTL CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- Google Fonts - Cairo -->
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="styles-purple.css"> <!-- أو styles-yellow.css حسب التفضيل -->
    <style>
        body {
            font-family: 'Cairo', sans-serif;
            background-color: #f8f9fa;
            padding-top: 20px;
        }
        .container {
            max-width: 800px;
        }
        .card {
            margin-bottom: 20px;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
        }
        .card-header {
            background-color: #e9ecef;
            border-bottom: 1px solid #dee2e6;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="text-center mb-4">لوحة تحكم العميل</h1>
        
        <div class="card">
            <div class="card-header">إضافة عرض جديد</div>
            <div class="card-body">
                <form id="addOfferForm">
                    <div class="mb-3">
                        <label for="offerTitle" class="form-label">عنوان العرض</label>
                        <input type="text" class="form-control" id="offerTitle" required>
                    </div>
                    <div class="mb-3">
                        <label for="offerDescription" class="form-label">وصف العرض</label>
                        <textarea class="form-control" id="offerDescription" rows="3" required></textarea>
                    </div>
                    <div class="mb-3">
                        <label for="offerImage" class="form-label">رابط صورة العرض</label>
                        <input type="url" class="form-control" id="offerImage">
                    </div>
                     <div class="mb-3">
                        <label for="offerLink" class="form-label">رابط تفاصيل العرض (اختياري)</label>
                        <input type="url" class="form-control" id="offerLink">
                    </div>
                    <button type="submit" class="btn btn-primary">إضافة العرض</button>
                </form>
            </div>
        </div>

        <!-- Section to edit Hero Content -->
        <div class="card">
            <div class="card-header">تعديل القسم الرئيسي</div>
            <div class="card-body">
                <form id="editHeroForm">
                    <div class="mb-3">
                        <label for="editHeroHeading" class="form-label">عنوان القسم الرئيسي</label>
                        <input type="text" class="form-control" id="editHeroHeading">
                    </div>
                    <div class="mb-3">
                        <label for="editHeroParagraph" class="form-label">الفقرة التوضيحية</label>
                        <textarea class="form-control" id="editHeroParagraph" rows="3"></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary">حفظ تغييرات القسم الرئيسي</button>
                </form>
            </div>
        </div>

        <!-- Section to edit General Content -->
        <div class="card">
            <div class="card-header">تعديل النصوص العامة</div>
            <div class="card-body">
                <div id="editableContentArea">
                    <!-- Editable fields will be generated here by JavaScript -->
                    <p class="text-muted">تحميل النصوص القابلة للتعديل...</p>
                </div>
                 <button id="saveGeneralContentBtn" class="btn btn-primary mt-3">حفظ جميع التغييرات</button>
            </div>
        </div>

        <!-- Section to display existing offers might go here -->
        <div class="card">
            <div class="card-header">العروض الحالية</div>
            <div class="card-body" id="offersList">
                <p class="text-muted">سيتم عرض العروض هنا بعد إضافتها.</p>
                <!-- Offers will be loaded here by JavaScript -->
            </div>
        </div>

    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    
    <script>
        // Firebase Configuration (using the config from home.html)
        const firebaseConfig = {
            apiKey: "AIzaSyDHSZQpsIu_KeE0EqVPhSEj8GzDh42-dPc",
            authDomain: "b-pr-6c81e.firebaseapp.com",
            projectId: "b-pr-6c81e",
            storageBucket: "b-pr-6c81e.firebasestorage.app",
            messagingSenderId: "343970150309",
            appId: "1:343970150309:web:47a4e08f9cb5b15e631a4c",
            measurementId: "G-ZH08VF66ME"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const offersRef = db.ref('offers'); // Reference to the 'offers' node
        const heroContentRef = db.ref('content/hero'); // Reference to hero content
        const contentRef = db.ref('content'); // Reference to general content

        // Get form and offers list element
        const addOfferForm = document.getElementById('addOfferForm');
        const offersList = document.getElementById('offersList');

        // Get hero edit form elements
        const editHeroForm = document.getElementById('editHeroForm');
        const editHeroHeadingInput = document.getElementById('editHeroHeading');
        const editHeroParagraphInput = document.getElementById('editHeroParagraph');

        // Get general editable content elements
        const editableContentArea = document.getElementById('editableContentArea');
        const saveGeneralContentBtn = document.getElementById('saveGeneralContentBtn');

        // Load hero content into the edit form when the page loads
        heroContentRef.once('value', (snapshot) => {
            const content = snapshot.val();
            if (content) {
                if (content.heading) {
                    editHeroHeadingInput.value = content.heading;
                }
                if (content.paragraph) {
                    editHeroParagraphInput.value = content.paragraph;
                }
            }
        }).catch((error) => {
            console.error('Error loading hero content for editing:', error);
        });

        // Handle hero edit form submission
        editHeroForm.addEventListener('submit', function(e) {
            e.preventDefault();

            const newHeading = editHeroHeadingInput.value;
            const newParagraph = editHeroParagraphInput.value;

            // Update hero content in Firebase
            heroContentRef.update({
                heading: newHeading,
                paragraph: newParagraph
            })
            .then(() => {
                alert('تم حفظ تغييرات القسم الرئيسي بنجاح!');
            })
            .catch((error) => {
                console.error('Error saving hero content:', error);
                alert('حدث خطأ عند حفظ تغييرات القسم الرئيسي.');
            });
        });

        // Function to load and display editable content
        function loadAndDisplayEditableContent() {
            contentRef.once('value', (snapshot) => {
                const contentData = snapshot.val() || {};
                editableContentArea.innerHTML = ''; // Clear loading message/placeholder

                // We need the keys from the home.html structure to build the form
                // For now, we will manually list the keys we added data-editable-key to.
                // A more advanced solution would involve reading home.html structure.
                const editableKeys = [
                    'hero-heading', 'hero-paragraph',
                    'services-title',
                    'whyus-title',
                    'portfolio-title',
                    'testimonials-title',
                    'cta-heading', 'cta-paragraph',
                    'about-title', 'about-paragraph1', 'about-paragraph2',
                    'stats-clients-label', 'stats-projects-label', 'stats-awards-label', 'stats-experience-label',
                    'contact-title',
                    'footer-description', 'footer-links-title', 'footer-social-title'
                ];

                editableKeys.forEach(key => {
                    const currentValue = contentData[key] || '';
                    const label = key.replace(/-/g, ' ').replace(/([A-Z])/g, ' $1').trim(); // Basic key formatting for label

                    const formGroup = document.createElement('div');
                    formGroup.classList.add('mb-3');

                    const labelElement = document.createElement('label');
                    labelElement.classList.add('form-label');
                    labelElement.textContent = label;
                    labelElement.setAttribute('for', key);

                    let inputElement;
                    // Use textarea for longer texts
                    if (key.includes('paragraph') || key.includes('description')) {
                        inputElement = document.createElement('textarea');
                        inputElement.rows = 3;
                    } else {
                        inputElement = document.createElement('input');
                        inputElement.type = 'text';
                    }
                    inputElement.classList.add('form-control');
                    inputElement.id = key;
                    inputElement.value = currentValue;
                    inputElement.setAttribute('data-editable-key', key); // Add key back to input for saving

                    formGroup.appendChild(labelElement);
                    formGroup.appendChild(inputElement);
                    editableContentArea.appendChild(formGroup);
                });
            }).catch((error) => {
                console.error('Error loading editable content for dashboard:', error);
                editableContentArea.innerHTML = '<p class="text-danger">حدث خطأ عند تحميل النصوص.</p>';
            });
        }

        // Handle saving general content
        saveGeneralContentBtn.addEventListener('click', function() {
            const updatedContent = {};
            const inputElements = editableContentArea.querySelectorAll('[data-editable-key]');

            inputElements.forEach(input => {
                const key = input.getAttribute('data-editable-key');
                updatedContent[key] = input.value;
            });

            // Save updated content to Firebase
            contentRef.update(updatedContent)
            .then(() => {
                alert('تم حفظ جميع تغييرات النصوص بنجاح!');
            })
            .catch((error) => {
                console.error('Error saving general content:', error);
                alert('حدث خطأ عند حفظ جميع التغييرات.');
            });
        });

        // Load editable content when the page loads
        window.addEventListener('DOMContentLoaded', loadAndDisplayEditableContent);

        // Handle add offer form submission
        addOfferForm.addEventListener('submit', function(e) {
            e.preventDefault();

            const offerTitle = document.getElementById('offerTitle').value;
            const offerDescription = document.getElementById('offerDescription').value;
            const offerImage = document.getElementById('offerImage').value;
            const offerLink = document.getElementById('offerLink').value;

            // Create a new offer object
            const newOffer = {
                title: offerTitle,
                description: offerDescription,
                imageUrl: offerImage,
                link: offerLink,
                timestamp: new Date().toISOString()
            };

            // Push the new offer to Firebase
            offersRef.push(newOffer)
                .then(() => {
                    alert('تم إضافة العرض بنجاح!');
                    addOfferForm.reset();
                })
                .catch((error) => {
                    console.error('Error adding offer:', error);
                    alert('حدث خطأ عند إضافة العرض.');
                });
        });

        // Listen for new offers added to Firebase
        offersRef.on('child_added', (snapshot) => {
            const offer = snapshot.val();
            const offerId = snapshot.key; // Get the unique key for the offer

            // Remove the initial placeholder text if it exists
            const placeholder = offersList.querySelector('.text-muted');
            if (placeholder) {
                placeholder.remove();
            }

            // Create HTML element for the offer
            const offerElement = document.createElement('div');
            offerElement.classList.add('card', 'mb-3'); // Add Bootstrap card classes
            offerElement.innerHTML = `
                <div class="card-body">
                    <h5 class="card-title">${offer.title}</h5>
                    <p class="card-text">${offer.description}</p>
                    ${offer.imageUrl ? `<img src="${offer.imageUrl}" class="img-fluid mb-3" alt="Offer Image">` : ''}
                    ${offer.link ? `<a href="${offer.link}" class="btn btn-secondary btn-sm" target="_blank">مشاهدة العرض</a>` : ''}
                </div>
            `;

            // Add the new offer element to the list
            offersList.appendChild(offerElement);
        });
    </script>
</body>
</html> 